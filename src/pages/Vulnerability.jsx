import {
  Box,
  Button,
  Container,
  Flex,
  Grid,
  Heading,
  Link,
  Select,
  Spinner,
  Text,
} from "@chakra-ui/react";
import React, { useEffect, useState } from "react";
import { useParams, Link as RouteLink } from "react-router-dom";
import axios from "axios";
import { FaStar, FaStarHalf } from "react-icons/fa6";

const Vulnerability = () => {
  const [results, setResults] = useState();
  const [loading, setLoading] = useState(true);

  let {productName} = useParams();

  const [filteringValue, setFilteringValue] = useState(
    productName || "smart door bells"
  );

  const handleFilter = (e) => {
    // console.log();
    setFilteringValue(e.target.value);
  };
  const fetchVulnerabilities = async () => {
    setLoading(true)
    const options = {
      method: "GET",
      url: "https://google-search74.p.rapidapi.com/",
      params: {
        query: `${filteringValue} vulnerabilities`,
        limit: "20",
        related_keywords: "true",
      },
      headers: {
        "X-RapidAPI-Key":
          "3212423239msh31eb2c53aad051dp1e7cbcjsn269648a75709",
        "X-RapidAPI-Host": "google-search74.p.rapidapi.com",
      },
    };
    const API_KEY = 'AIzaSyC9JQbBmexT9gdLcF0k9O-5HRmMvQlVDPw';
    const SEARCH_ENGINE_ID = 'a19c1e64c1a704db0';
    try {
      const response = await axios.request(`https://www.googleapis.com/customsearch/v1?q=${`${filteringValue} vulnerabilities`}&key=${API_KEY}&cx=${SEARCH_ENGINE_ID}`);
      setResults(response.data.items);
    } catch (error) {
      console.error(error);
    }
    setLoading(false);
  };
  useEffect(() => {
    fetchVulnerabilities();
  }, [filteringValue]);
  const links = [
    {
      title: "‘Smart’ Doorbell Vulnerabilities",
      image:
        "https://cyberhoot.com/wp-content/uploads/2020/11/ring-doorbell-hack.jpg",
      link: "https://cyberhoot.com/blog/smart-doorbell-vulnerabilities/",
    },
    {
      image:
        "https://documents.trendmicro.com/images/TEx/articles/20190213231245113-632-d74bpia-800.jpg",
      link:
        "https://www.trendmicro.com/vinfo/us/security/news/internet-of-things/amazon-patches-ring-video-doorbell-pro-vulnerability-that-threatens-network-security",
    },
    {
      image:
        "https://article.images.consumerreports.org/image/upload/w_652,f_auto,q_auto,ar_16:9,c_lfill/v1708955430/prod/content/dam/CRO-Images-2024/Electronics/CR-Tech-Inlinehero-generic-video-doorbell-security-0224",
      link:
        "https://www.consumerreports.org/home-garden/home-security-cameras/video-doorbells-sold-by-major-retailers-have-security-flaws-a2579288796/",
    },
    {
      image:
        "https://media.cnn.com/api/v1/images/stellar/prod/gettyimages-1323514886.jpg?c=16x9&q=h_653,w_1160,c_fill/f_webp",
      link:
        "https://edition.cnn.com/2024/03/09/tech/smart-home-cameras-hackers-security/index.html#:~:text=Less%20than%20two%20weeks%20after,footage%20stored%20on%20the%20app.",
    },
    "",
  ];

  return (
    <Container
      position={"relative"}
      pt={28}
      pb="12"
      maxW={{ base: "90vw", sm: "85vw", md: "80vw", lg: "75vw" }}
      mx="auto"
    >
       <Flex gap="4" alignItems={"center"}>
            <Text fontWeight={"semibold"} mb="0">
              Filter:
            </Text>
            <Select
              maxW="20rem"
              cursor={"pointer"}
              onChange={(e) => handleFilter(e)}
            >
              <option value="smart door bells">Smart Door Bells</option>
              <option value="smart thermostat">Smart Thermostat</option>
            </Select>
          </Flex>
      <Heading mb="8" textTransform={"capitalize"}>{filteringValue} Vulnerability</Heading>
      {loading ? (
        <Grid minH={"15rem"} placeItems={"center"}>
          <Spinner size={"xl"} />
        </Grid>
      ) : (
        <Flex flexDir={"column"} gap="4">
          {results.map(({ cacheId, link, title, snippet }) => (
            <Box key={cacheId}>
              <Link
                href={link}
                fontWeight={"semibold"}
                target="_blank"
                color={"primary"}
                fontSize={"1.2rem"}
              >
                {title}
              </Link>
              <Text>{snippet}</Text>
            </Box>
          ))}
        </Flex>
      )}
      <Box pos="fixed" bottom="3rem" right={"3rem"}>
        <Button
          animation={"blink 1s linear infinite"}
          color={"white"}
          bg="primary"
          _hover={{ animation: "unset" }}
          as={RouteLink}
          to={`/vulnerability_control/${productName}`}
        >
          See Control Measures
        </Button>
      </Box>
    </Container>
  );
};

export default Vulnerability;
